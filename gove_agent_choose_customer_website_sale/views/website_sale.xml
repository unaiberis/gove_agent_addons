<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Show payment mode in cart, payment and confirmation -->
    <template id="template_payment_mode" name="Payment Mode">
        <t t-set="customer_id" t-value="int(
            request.env['agent.partner'].sudo().search([
                ('agent_id', '=', request.env.user.sudo().partner_id.id)
            ], limit=1).customer_id_chosen_by_agent
        ) if request.env.user.sudo().partner_id.agent else request.env.user.sudo().partner_id.id" />

        <t t-set="property_record" t-value="request.env['ir.property'].sudo().search([
                ('value_reference', 'ilike', 'account.payment.mode'),
                ('res_id', '=', 'res.partner,' + str(customer_id))
            ], limit=1)" />

        <t t-if="property_record">
            <t t-set="payment_mode_id" t-value="int(property_record.value_reference.split(',')[1])" />
            <t t-set="payment_mode" t-value="request.env['account.payment.mode'].sudo().browse(payment_mode_id)" />

            <t t-if="payment_mode.name and payment_mode.name.strip()">
                <t t-esc="payment_mode.name" />
            </t>
        </t>
    </template>

    <template id="agent_customer_card_insert" inherit_id="website_sale_assign_agent_customer.agent_customer_card">
        <xpath expr="//div[hasclass('o_wsaac_agent_customers')]" position="inside">
            <div class="card-body">
                <div>
                    <b>Payment mode used by the customer:</b>
                    <t t-call="gove_agent_choose_customer_website_sale.template_payment_mode" />
                </div>
            </div>
        </xpath>
    </template>

    <template id="template_payment_tokens_list" inherit_id="payment.payment_tokens_list" name="Replace Payment Mode">
        <xpath expr="//div/label/span[hasclass('payment_option_name')]" position="replace">
            <t t-call="gove_agent_choose_customer_website_sale.template_payment_mode" />
        </xpath>
    </template>


    <template id="template_confirmation" inherit_id="website_sale.confirmation" name="Replace Payment Mode">
        <xpath expr="//table[hasclass('table')]/tbody/tr/td/t[2]" position="replace">
            <t t-call="gove_agent_choose_customer_website_sale.template_payment_mode" />
        </xpath>
    </template>


    <!-- Add PCT, PVP and STOCK or NO STOCK in each product -->

    <template id="products_item_add_tariff_price" inherit_id="website_sale.products_item">
        <xpath expr="//div[hasclass('product_price')]" position="replace">
            <div class="product_price" itemprop="offers" itemscope="itemscope" itemtype="http://schema.org/Offer">

                <div class="d-flex flex-row justify-content-between align-items-center">
                    <div class="w-70 d-flex flex-column">
                        <div style="width: 100%; text-align: left; font-size: 11px; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">
                            <t t-if="combination_info['price'] and combination_info['PVP'] != combination_info['price']">
                                <div>
                                    <!-- PCT -->
                                    <span style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">
                                        Price</span>
                                    <span t-esc="combination_info['price']" t-options="{'widget': 'monetary', 'display_currency': website.currency_id}" />
                                </div>
                            </t>
                        </div>

                        <t t-if="combination_info['PVP']">
                            <div style="width: 100%; text-align: left; font-size: 11px; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">
                                <div>
                                    <!-- PVP -->
                                    <span style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">
                                        RRP</span>
                                    <span t-esc="combination_info['PVP']" t-options="{'widget': 'monetary', 'display_currency': website.currency_id}" />
                                </div>
                            </div>
                        </t>
                    </div>
                    <div style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-size: 11px;">
                        CODE: <t t-esc="product.default_code" />
                    </div>
                    <div style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-size: 11px;">

                    <svg id='Sale_24' width='24' height='24' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'><rect width='24' height='24' stroke='none' fill='#000000' opacity='0'/>


<g transform="matrix(0.17 0 0 0.17 12 12)" >
<path style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-dashoffset: 0; stroke-linejoin: miter; stroke-miterlimit: 4; fill: rgb(0,0,0); fill-rule: nonzero; opacity: 1;" transform=" translate(-63.95, -64.05)" d="M 79.605469 6.5703125 C 76.811719 6.40625 74.075391 7.3242187 71.900391 9.1992188 L 67.199219 13.199219 C 65.299219 14.799219 62.599219 14.799219 60.699219 13.199219 L 56 9.1992188 C 53.2 6.7992188 49.2 5.9992187 45.5 7.1992188 C 41.8 8.3992187 39.099219 11.299609 38.199219 15.099609 L 36.800781 21.099609 C 36.200781 23.499609 33.999609 25.100391 31.599609 24.900391 L 25.5 24.400391 C 21.7 24.100391 17.999219 25.800391 15.699219 28.900391 C 13.399219 32.000391 13.000391 35.999609 14.400391 39.599609 L 16.699219 45.300781 C 17.599219 47.600781 16.799219 50.2 14.699219 51.5 L 9.5 54.699219 C 6.2 56.699219 4.3007813 60.199609 4.3007812 64.099609 C 4.3007812 67.999609 6.3 71.5 9.5 73.5 L 14.699219 76.699219 C 16.799219 77.999219 17.599219 80.600391 16.699219 82.900391 L 14.400391 88.599609 C 12.900391 92.199609 13.399219 96.200781 15.699219 99.300781 C 17.999219 102.40078 21.6 104.10078 25.5 103.80078 L 31.599609 103.30078 C 34.099609 103.10078 36.300781 104.69961 36.800781 107.09961 L 38.199219 113.09961 C 39.099219 116.79961 41.8 119.8 45.5 121 C 46.6 121.4 47.800391 121.5 48.900391 121.5 C 51.500391 121.5 54 120.60039 56 118.90039 L 60.699219 114.90039 C 62.599219 113.30039 65.299219 113.30039 67.199219 114.90039 L 71.900391 118.90039 C 74.800391 121.40039 78.800391 122.2 82.400391 121 C 86.100391 119.8 88.799219 116.89961 89.699219 113.09961 L 91.099609 107.09961 C 91.699609 104.69961 93.900781 103.10078 96.300781 103.30078 L 102.40039 103.80078 C 106.20039 104.10078 109.89922 102.40078 112.19922 99.300781 C 114.49922 96.200781 114.9 92.199609 113.5 88.599609 L 111.19922 82.900391 C 110.29922 80.500391 111.09922 77.899609 113.19922 76.599609 L 118.40039 73.400391 C 121.70039 71.400391 123.59961 67.9 123.59961 64 C 123.59961 60.1 121.60039 56.599609 118.40039 54.599609 L 113.19922 51.400391 C 111.09922 50.100391 110.29922 47.499219 111.19922 45.199219 L 113.5 39.5 C 115 35.9 114.49922 31.900781 112.19922 28.800781 C 109.89922 25.700781 106.30039 24.000781 102.40039 24.300781 L 96.300781 24.800781 C 93.800781 25.000781 91.599609 23.4 91.099609 21 L 89.699219 15 C 88.799219 11.3 86.100391 8.2996094 82.400391 7.0996094 C 81.475391 6.7996094 80.536719 6.625 79.605469 6.5703125 z M 48.570312 12.777344 C 49.83125 12.707031 51.049609 13.1 52.099609 14 L 56.800781 18 C 60.900781 21.5 66.899609 21.5 71.099609 18 L 75.800781 14 C 77.200781 12.8 78.899609 12.5 80.599609 13 C 82.299609 13.5 83.500391 14.899609 83.900391 16.599609 L 85.300781 22.599609 C 86.600781 27.899609 91.400781 31.4 96.800781 31 L 102.90039 30.5 C 104.70039 30.4 106.30078 31.1 107.30078 32.5 C 108.30078 33.9 108.60039 35.700781 107.90039 37.300781 L 105.59961 43 C 103.49961 48 105.4 53.699609 110 56.599609 L 115.19922 59.800781 C 116.69922 60.700781 117.59961 62.299609 117.59961 64.099609 C 117.59961 65.899609 116.69922 67.400391 115.19922 68.400391 L 110.09961 71.5 C 105.49961 74.3 103.59922 80.099609 105.69922 85.099609 L 108 90.800781 C 108.7 92.400781 108.50039 94.199609 107.40039 95.599609 C 106.30039 96.999609 104.7 97.799609 103 97.599609 L 96.900391 97.099609 C 91.500391 96.699609 86.600391 100.2 85.400391 105.5 L 84 111.5 C 83.6 113.2 82.399219 114.49961 80.699219 115.09961 C 78.999219 115.59961 77.300391 115.29961 75.900391 114.09961 L 71.199219 110.09961 C 67.099219 106.59961 61.100391 106.59961 56.900391 110.09961 L 52.199219 114.09961 C 50.799219 115.29961 49.100391 115.59961 47.400391 115.09961 C 45.700391 114.59961 44.499609 113.2 44.099609 111.5 L 42.699219 105.5 C 41.499219 100.5 37.1 97.099609 32 97.099609 L 31.099609 97.099609 L 25 97.599609 C 23.2 97.699609 21.599609 96.999609 20.599609 95.599609 C 19.599609 94.199609 19.3 92.400781 20 90.800781 L 22.300781 85.099609 C 24.400781 80.099609 22.500391 74.4 17.900391 71.5 L 12.699219 68.300781 C 11.199219 67.400781 10.300781 65.8 10.300781 64 C 10.300781 62.2 11.199219 60.699219 12.699219 59.699219 L 17.900391 56.5 C 22.500391 53.7 24.400781 47.900391 22.300781 42.900391 L 20 37.300781 C 19.3 35.700781 19.499609 33.9 20.599609 32.5 C 21.599609 31.1 23.3 30.3 25 30.5 L 31.099609 31 C 36.499609 31.4 41.399609 27.899609 42.599609 22.599609 L 44 16.599609 C 44.4 14.899609 45.600781 13.6 47.300781 13 C 47.725781 12.875 48.15 12.800781 48.570312 12.777344 z M 51 42 C 46 42 42 46 42 51 C 42 56 46 60 51 60 C 56 60 60 56 60 51 C 60 46 56 42 51 42 z M 78.863281 44.050781 C 78.100781 44.100781 77.350781 44.449609 76.800781 45.099609 L 54.800781 70 C 53.700781 71.2 53.799609 73.099219 55.099609 74.199219 C 55.699609 74.699219 56.399609 75 57.099609 75 C 57.899609 75 58.800391 74.7 59.400391 74 L 81.400391 49.099609 C 82.300391 47.699609 82.2 45.800781 81 44.800781 C 80.4 44.250781 79.625781 44.000781 78.863281 44.050781 z M 51 48 C 52.7 48 54 49.3 54 51 C 54 52.7 52.7 54 51 54 C 49.3 54 48 52.7 48 51 C 48 49.3 49.3 48 51 48 z M 77 68 C 72 68 68 72 68 77 C 68 82 72 86 77 86 C 82 86 86 82 86 77 C 86 72 82 68 77 68 z M 77 74 C 78.7 74 80 75.3 80 77 C 80 78.7 78.7 80 77 80 C 75.3 80 74 78.7 74 77 C 74 75.3 75.3 74 77 74 z M 49 78 C 47.34314575050762 78 46 79.34314575050762 46 81 C 46 82.65685424949238 47.34314575050762 84 49 84 C 50.65685424949238 84 52 82.65685424949238 52 81 C 52 79.34314575050762 50.65685424949238 78 49 78 z" stroke-linecap="round" />
</g>
</svg>
                        EN OFERTA
                    </div>
                </div>
                <t t-set="inventory_availability" t-value="product.inventory_availability" />

                <div id="stock_widget" style="width: 100%; display: flex; justify-content: space-between; font-size: smaller; text-align: left;">
                    <!-- <t t-set="is_available" t-value="request.env['product.template'].sudo().search([('id', '=', product.id)]).virtual_available > 0" />

                    <span t-if="is_available" style="color: green;">
                        <span>Stock</span>
                    </span>

                    <span t-else="" style="color: red;">
                        <span>No stock</span>
                    </span> -->
                    <t t-set="int_virtual_available" t-value="int(product.virtual_available)" />

                    <t t-if="product.inventory_availability in ['always', 'threshold']">
                        <t t-if="product.virtual_available &gt; 0">
                            <div t-if="product.inventory_availability == 'always'" t-attf-class="availability_message_#{product_template} text-success" style="margin-bottom: 5px;">
                                <t t-esc="virtual_available_formatted" />
                                <t t-esc="uom_name" />
 available
                            </div>
                            <t t-if="product.inventory_availability == 'threshold'">
                                <div t-if="product.virtual_available &lt;= product.available_threshold" t-attf-class="availability_message_#{product_template} text-warning" style="margin-bottom: 5px;">
                                    <i class="fa fa-exclamation-triangle" title="Warning" role="img" aria-label="Warning"/>
                                    <t t-esc="int_virtual_available" />
                                    <t t-esc="product.uom_name" />
 available
                                </div>
                                <div t-if="product.virtual_available &gt; product.available_threshold" t-attf-class="availability_message_#{product_template} text-success ">In stock</div>
                            </t>
                        </t>
                        <div t-if="order_line" t-attf-class="availability_message_#{product_template} text-warning mt8" style="margin-bottom: 5px;">
                You already added <t t-if="not product.virtual_available">all</t>
                            <t t-esc="int(order_line[0].product_uom_qty) if order_line and order_line[0].product_uom_qty else 0" />
                            <t t-esc="product.uom_name" />
 in your cart.
                        </div>
                        <div t-if="product.virtual_available &lt;= 0" t-attf-class="availability_message_#{product_template} text-danger" style="margin-bottom: 5px;">
                            <i class="fa fa-exclamation-triangle" role="img" aria-label="Warning" title="Warning"/>
 Temporarily out of stock</div>

                    </t>
                </div>
            </div>
        </xpath>


        <!-- Change style of every product to show image bigger and make box height bigger -->

        <xpath expr="//form[hasclass('oe_product_cart')]//div[hasclass('o_wsale_product_information')]" position="before">
            <style>
                form.card.oe_product_cart{
                height: 280px;
                }
                .table-borderless tr {
                height: 300px;
                }
                .oe_product.oe_image_full .o_wsale_product_information{
                position: relative;
                }
            </style>
        </xpath>
    </template>


    <template id="remove_pricelist_from_product_from_website_sale" inherit_id="website_sale.product" name="Remove Pricelist from Product Form in Website sale">

        <!-- Remove pricelist from product from website sale -->

        <xpath expr="//div[@class='col-md-8']/div[@class='form-inline justify-content-end']/t[@t-call='website_sale.pricelist_list']" position="replace">
        </xpath>

        <xpath expr="//div[@id='product_attributes_simple']" position="after">

            <div style="font-family: Roboto; font-size: 14px;"> CODE: <t t-esc="product.default_code" />
            </div>
        </xpath>

    </template>

    <!-- Remove cart button from product from website sale -->

    <template id="template_products_item" inherit_id="website_sale.products_item" name="Template Name">
        <xpath expr="//div[contains(@class, 'o_wsale_product_btn')]" position="attributes">
            <attribute name="style">display: none;</attribute>
        </xpath>
    </template>

</odoo>